@using Rent_A_Car.CORE.Enums
@using Rent_A_Car.MVC.VM
@model AdvertisementDetailViewModel
<!-- content begin -->
<div class="no-bottom no-top zebra" id="content">
	<div id="top"></div>

	<!-- section begin -->
	<section id="subheader" class="jarallax text-light">
		<img src="~/images/background/subheader.jpg" class="jarallax-img" alt="">
		<div class="center-y relative text-center">
			<div class="container">
				<div class="row">
					<div class="col-md-12 text-center">
						<h1>Booking</h1>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</div>
	</section>
	<!-- section close -->

	<section id="section-hero" aria-label="section" class="no-top mt-80 sm-mt-0">
		<div class="container">
			<div class="row align-items-center">

				<div class="col-lg-12">
					<div class="spacer-single sm-hide"></div>
					<div class="p-4 rounded-3 shadow-soft" data-bgcolor="#ffffff">


						<form asp-controller="Booking" asp-action="Book" class="form-s2 row g-4 on-submit-hide" method="post">

							<div class="col-lg-6 d-light">
								<h4>Rent A Car</h4>
								<img width="200px" src="~/img/cars/@Model.Advertisement.ImageUrl" />
							</div>

							<h5>Location</h5>
							<select asp-for="BookingDTO.PickupLocation" class="form-control">
								@foreach (PickupLocation item in Enum.GetValues(typeof(PickupLocation)))
								{
									<option value="@item">@item</option>
								}
							</select>


							<!-- Advertisement ID (Gizli Alan) -->
							<input type="hidden" asp-for="BookingDTO.AdvertisementId" value="@Model.Advertisement.Id">

							<!-- Kullanıcı ID (Gizli Alan) -->
							<input type="hidden" asp-for="BookingDTO.UserID" value="@Model.BookingDTO.UserID">

							<!-- Pick Up Date -->
							<label>Pick Up Date:</label>
							<input type="text" id="pickup-date" asp-for="BookingDTO.StartDate" placeholder="PickUp Date" class="form-control" required>

							<!-- Pick Up Time -->
							<label>Pick Up Time:</label>
							<input type="time" asp-for="BookingDTO.PickupTime" class="form-control" required>

							<!-- Return Date -->
							<label>Return Date:</label>
							<input type="text" id="return-date" asp-for="BookingDTO.EndDate" placeholder="Return Date" class="form-control" required>

							<!-- Return Time -->
							<label>Return Time:</label>
							<input type="time" asp-for="BookingDTO.DropoffTime" class="form-control" required>

							<label>Phone Number:</label>
							<div style="width:500px; display: flex; align-items: center; margin-right:200px" >
								<span class="input-group-text form-control" style="width: 80px; text-align: center;">+994</span>
								<select id="phonePrefix" class="form-select form-control" style="width: 80px;">
									<option value="50">50</option>
									<option value="55">55</option>
									<option value="70">70</option>
									<option value="77">77</option>
								</select>
								<input id="phoneNumber" type="text" class="form-control" placeholder="XXXXXXX" maxlength="7" style="width: 150px;" required>
							</div>


							<!-- Gizli input - ASP.NET backend-ə göndərmək üçün -->
							<input type="hidden" asp-for="BookingDTO.PhoneNumber" id="fullPhoneNumber">

							<span id="phoneError" class="text-danger"></span>


							<!-- Toplam Fiyat -->
							<label>Total Price:</label>
							<input style="width:200px" type="text" id="total-price" class="form-control" readonly>

							@if (TempData["Error"] != null)
							{
								<div class="alert alert-danger">@TempData["Error"]</div>
							}

							@if (TempData["Success"] != null)
							{
								<div class="alert alert-success">@TempData["Success"]</div>
							}
							<div class="col-lg-3">
								<button type="submit" class="btn btn-primary">Ödəniş et</button>
							</div>
						</form>
					</div>
				</div>
			</div>

			<div class="spacer-single"></div>

			<div class="row">

				<div class="col-md-3 wow fadeInRight" data-wow-delay=".2s">
					<div class="feature-box style-4 text-center">
						<a href="#"><i class="bg-color text-light i-boxed fa fa-car"></i></a>
						<div class="text">
							<a href="#"><h4>Choose a vehicle</h4></a>
							Unlock unparalleled adventures and memorable journeys with our vast fleet of vehicles tailored to suit every need, taste, and destination.
						</div>
						<span class="wm">1</span>
					</div>
				</div>

				<div class="col-md-3 wow fadeInRight" data-wow-delay=".4s">
					<div class="feature-box style-4 text-center">
						<a href="#"><i class="bg-color text-light i-boxed fa fa-calendar"></i></a>
						<div class="text">
							<a href="#"><h4>Pick location &amp; date</h4></a>
							Pick your ideal location and date, and let us take you on a journey filled with convenience, flexibility, and unforgettable experiences.
						</div>
						<span class="wm">2</span>
					</div>
				</div>

				<div class="col-md-3 wow fadeInRight" data-wow-delay=".6s">
					<div class="feature-box style-4 text-center">
						<a href="#"><i class="bg-color text-light i-boxed fa fa-pencil-square-o"></i></a>
						<div class="text">
							<a href="#"><h4>Make a booking</h4></a>
							Secure your reservation with ease, unlocking a world of possibilities and embarking on your next adventure with confidence.
						</div>
						<span class="wm">3</span>
					</div>
				</div>

				<div class="col-md-3 wow fadeInRight" data-wow-delay=".6s">
					<div class="feature-box style-4 text-center">
						<a href="#"><i class="bg-color text-light i-boxed fa fa-smile-o"></i></a>
						<div class="text">
							<a href="#"><h4>Sit back & relax</h4></a>
							Hassle-free convenience as we take care of every detail, allowing you to unwind and embrace a journey filled comfort.
						</div>
						<span class="wm">3</span>
					</div>
				</div>
			</div>
		</div>
	</section>

	

	<section aria-label="section" class="pt40 pb40 text-light" data-bgcolor="#181818">
		<div class="wow fadeInRight d-flex">
			<div class="de-marquee-list">
				<div class="d-item">
					<span class="d-item-txt">SUV</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Hatchback</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Crossover</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Convertible</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Sedan</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Sports Car</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Coupe</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Minivan</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Station Wagon</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Truck</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Minivans</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Exotic Cars</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
				</div>
			</div>

			<div class="de-marquee-list">
				<div class="d-item">
					<span class="d-item-txt">SUV</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Hatchback</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Crossover</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Convertible</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Sedan</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Sports Car</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Coupe</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Minivan</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Station Wagon</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Truck</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Minivans</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
					<span class="d-item-txt">Exotic Cars</span>
					<span class="d-item-display">
						<i class="d-item-dot"></i>
					</span>
				</div>
			</div>
		</div>
	</section>


</div>
<!-- content close -->

<a href="#" id="back-to-top"></a>

@section scripts {
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
	<script>
		$(document).ready(function() {
			var advertisementId = @Model.Advertisement.Id; // İlan ID'si

			// API'den engellenen tarihler verisini alalım
			$.getJSON('/Booking/GetUnavailableDates', { advertisementId: advertisementId }, function(data) {
				var disabledDates = [];

				// API'den gelen verileri işle
				data.forEach(function(booking) {
					var startDate = new Date(booking.startDate);
					var endDate = new Date(booking.endDate);

					// StartDate ile EndDate arasındaki tüm günleri disabled yap
					while (startDate <= endDate) {
						var dateString = startDate.toISOString().split('T')[0]; // YYYY-MM-DD formatı
						disabledDates.push(dateString); // Engellenen tarihleri listeye ekle
						startDate.setDate(startDate.getDate() + 1); // Sonraki güne geç
					}
				});

				// Tarih seçiciye engellenen tarihleri uygulayalım
				$("#pickup-date, #return-date").datepicker({
					beforeShowDay: function(date) {
						var string = jQuery.datepicker.formatDate('yy-mm-dd', date);
						// Eğer tarih disabledDates içinde yoksa, seçilebilir
						return [disabledDates.indexOf(string) == -1];
					},
					dateFormat: "yy-mm-dd", // Tarih formatı
					minDate: 1 // Bugünden önceki tarihler seçilemez
				});
			}).fail(function() {
				console.log("API çağrısı başarısız oldu!"); // Hata mesajı
			});
		});
	</script>
	



	<script>
		$(document).ready(function() {
			var dailyPrice = @Model.Advertisement.Price; // Örnek günlük fiyat (örneğin 50 TL/gün)

			// Tarih seçim işlemleri
			$('#pickup-date, #return-date').on('change', function() {
				// Tarihler alınıyor
				var pickupDate = $('#pickup-date').val();
				var returnDate = $('#return-date').val();

				if (pickupDate && returnDate) {
					// Tarihler arasında fark hesaplanıyor
					var startDate = new Date(pickupDate);
					var endDate = new Date(returnDate);

					// Tarih farkı (gün cinsinden)
					var timeDiff = endDate - startDate;
					var daysDifference = timeDiff / (1000 * 3600 * 24); // Gün farkı

					if (daysDifference > 0) {
						// Toplam fiyat hesaplanıyor
						var totalPrice = daysDifference * dailyPrice;

						// Toplam fiyat input alanına yazılıyor
						$('#total-price').val(totalPrice + ' AZN');
					} else {
						// Eğer geçersiz tarih aralığı varsa
						$('#total-price').val('Yanlis vaxt araligi');
					}
				}
			});
		});
	</script>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const phonePrefix = document.getElementById("phonePrefix");
			const phoneInput = document.getElementById("phoneNumber");
			const fullPhoneInput = document.getElementById("fullPhoneNumber");
			const phoneError = document.getElementById("phoneError");

			function updateFullPhoneNumber() {
				let prefix = phonePrefix.value;
				let number = phoneInput.value.replace(/\D/g, "").substring(0, 7); // Yalnız 7 rəqəm
				phoneInput.value = number; // Inputu formatla

				if (number.length < 7) {
					phoneError.innerText = "Telefon nömrəsi tam və bitişik yazılmalıdır (XXXXXXX).";
				} else {
					phoneError.innerText = "";
				}

				// ASP.NET backend-ə göndərmək üçün tam nömrəni gizli input-a yazırıq
				fullPhoneInput.value = "+994" + prefix + number;
			}

			phonePrefix.addEventListener("change", updateFullPhoneNumber);
			phoneInput.addEventListener("input", updateFullPhoneNumber);
		});
	</script>

}